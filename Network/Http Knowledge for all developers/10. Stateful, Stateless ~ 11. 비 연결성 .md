# 10. 무상태 프로토콜
## 스테이스리스(Stateless)

+ 서버가 클라이언트의 상태를 보존X
  
+ 장점: 서버 확장성 높음(스케일 아웃)

+ 단점: 클라이언트가 추가 데이터 전송

## Stateful, Stateless 차이
## 상태 유지 - Stateful

+ 고객: 이 노트북 얼마인가요?

+ 점원: 100만원 입니다.

+ 고객: 2개 구매하겠습니다.

+ 점원: 200만원 입니다. 신용카드, 현금중에 어떤 걸로 구매 하시겠어요?

+ 고객: 신용카드로 구매하겠습니다.

+ 점원: 200만원 결제 완료되었습니다.

## 상태 유지 - Stateful, 점원이 중간에 바뀌면?

• 고객: 이 노트북 얼마인가요?

• 점원A: 100만원 입니다.

• 고객: 2개 구매하겠습니다.

• 점원B: ? 무엇을 2개 구매하시겠어요?

• 고객: 신용카드로 구매하겠습니다.

• 점원C: ? 무슨 제품을 몇게 신용카드로 구매하시겠어요?

## 상태 유지 - Stateful, 정리

+ 고객: 이 노트북 얼마인가요?

+ 점원: 100만원 입니다. (노트북 상태 유지)

+ 고객: 2개 구매하겠습니다.

+ 점원: 200만원 입니다. 신용카드, 현금중에 어떤 걸로 구매 하시겠어요?

(노트북, 2개 상태 유지)

+ 고객: 신용카드로 구매하겠습니다.

+ 점원: 200만원 결제 완료되었습니다. (노트북, 2개, 신용카드 상태 유지)

## 무상태 - Stateless - 마지막 대화만으로 결재를 완료 할 수있다.

+ 고객: 이 노트북 얼마인가요?

+ 점원: 100만원 입니다.

+ 고객: 노트북 2개 구매하겠습니다.

+ 점원: 노트북 2개는 200만원 입니다. 신용카드, 현금중에 어떤 걸로 구매 하시겠어요?

+ 고객: 노트북 2개를 신용카드로 구매하겠습니다.

+ 점원: 200만원 결제 완료되었습니다

## 무상태 - Stateless, 점원이 중간에 바뀌면? - 이경우 역시 마지막 대화만으로 결재가 가능하다. / 중간에 점원이 바뀌어도 아무 문제가 없다.

+ 고객: 이 노트북 얼마인가요?

+ 점원A: 100만원 입니다.

+ 고객: 노트북 2개 구매하겠습니다.

+ 점원B: 노트북 2개는 200만원 입니다. 신용카드, 현금중에 어떤 걸로 구매 하시겠어요?

+ 고객: 노트북 2개를 신용카드로 구매하겠습니다.

+ 점원C: 200만원 결제 완료되었습니다


## Stateful, Stateless 차이

## 정리

+ 상태 유지: 중간에 다른 점원으로 바뀌면 안된다.

(중간에 다른 점원으로 바뀔 때 상태 정보를 다른 점원에게 미리 알려줘야 한다.)

+ 무상태: 중간에 다른 점원으로 바뀌어도 된다.

  - 갑자기 고객이 증가해도 점원을 대거 투입할 수 있다.

  - 갑자기 클라이언트 요청이 증가해도 서버를 대거 투입할 수 있다.

+ 무상태는 응답 서버를 쉽게 바꿀 수 있다. -> **무한한 서버 증설 가능**
  
  - 스케일 아웃 - 수평 확장에 유리하다.

## Stateless, 실무 한계

+ 모든 것을 무상태로 설계 할 수 있는 경우도 있고 없는 경우도 있다.

+ 무상태

  - 예) 로그인이 필요 없는 단순한 서비스 소개 화면

+ 상태 유지

  - 예) 로그인

+ 로그인한 사용자의 경우 로그인 했다는 상태를 서버에 유지

+ 일반적으로 브라우저 쿠키와 서버 세션등을 사용해서 상태 유지

+ **상태 유지는 최소한만 사용**

# Stateless의 단점

+ 데이터를 너무 많이 보낸다.
  - 노트북 + 2개를 + 신용카드로 계산하겠습니다. => 전송해야 되는 데이터가 많다.  
  
# 11. 비 연결성(connectionless)  
  
+ 연결을 유지하는 모델 
  - 단점 : 다른 클라이언트들이 놀고 있어도 계속 연결 서버를 유지

+ 연결을 유지하지 않는 모델
  - 서버 입장에서는 서버의 자원을 최소한으로 줄일 수 있다.

## 비 연결성

+ HTTP는 기본이 연결을 유지하지 않는 모델

+ 일반적으로 초 단위의 이하의 빠른 속도로 응답

+ 1시간 동안 수천명이 서비스를 사용해도 실제 서버에서 동시에 처리하는 요청은 수십개 이하로 매우 작음

  - 예) 웹 브라우저에서 계속 연속해서 검색 버튼을 누르지는 않는다.

+ 서버 자원을 매우 효율적으로 사용할 수 있음

## 비 연결성 한계와 극복

+ 한계 : TCP/IP 연결을 새로 맺어야 함 - 3 way handshake 시간 추가

+ 한계 : 웹 브라우저로 사이트를 요청하면 HTML 뿐만 아니라 자바스크립트, css, 추가 이미지 등등 수 많은 자원이 함께 다운로드
  - 자원을 받을 때마다 연결해야 함
  
+ 극복 : 지금은 HTTP 지속 연결(Persistent Connections)로 문제 해결

+ 극복 : HTTP/2, HTTP/3에서 더 많은 최적화

## 초기 HTTP  - 연결, 종료 낭비

![image](https://user-images.githubusercontent.com/49984996/103130492-3faf3e00-46e0-11eb-91b6-e48401c3f965.png)

> 연결을 새로 맞는 모습

## HTTP 지속 연결(Persistent Connections)

![image](https://user-images.githubusercontent.com/49984996/103130538-67060b00-46e0-11eb-9a09-60a5ccec3f41.png)

# 스테이트리스방식으로 설계 해야되는 것을 기억하자

