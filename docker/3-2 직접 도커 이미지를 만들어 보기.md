# 직접 도커 이미지를 만들어 보기

+ 그동안 도커 이미지를 항상 도커 허브에서 가져와서 사용했었다.
+ 이제 직접 만들어서 사용해보고, 직접 만든 도커 이미지를 도커 허브에 올려서 공유해 보자

### 도커 이미지 생성하는 순서
1. Dockerfile 작성 : Dockerfile이란 Docker Image를 만들기 위한 설정 파일입니다. 컨테이너가 어떻게 행동해야 하는지에 대한 설정들을 정의 해줌
2. 도커 클라이언트 : 도커 파일에 입력된 것들이 도커 클라이언트에 전달되어야 합니다.
3. 도커 서버 : 도커 클라이언트에 전달된 모든 중요한 작업들을 하는 곳
4. 이미지 생성

## DockerFile 만들기

### 도커파일 만드는 순서( 도커 이미지가 필요한 것이무엇인지 생각하기)

1. 베이스 이미지를 명시해준다. (파일 스냅샷에 해당)

2. 추가적으로 필요한 파일을 다운 받기 위한 몇가지 명령어를 명시(파일 스냅샷에 해당)

3. 컨테이너 시작시 실행 될 명령어를 명시한다.

#### 베이스 이미지란?

+ 이미지는 레이어 별로 구성되어 있다.
+ 레이어 중에서 근본이 되는 레이어를 베이스 이미지라고 한다.
  - 어떠한 OS를 쓸건지 명시해야 한다.

1. FROM : 이미지 생성시 기반이 되는 이미지 레이어 입니다.
  
  - 이미지 이름:태그 형식으로 작성
  - 태그를 안붙이면 자동적으로 가장 최신것으로 다운 받음
  - 예) ubuntu:14.0.4

2. RUN : 도커이미지가 생성되기 전에 수행할 쉘 명령어
3. CMD : 컨테이너가 시작되었을 떄 실행할 실행 파일 또는 쉘 스크립트입니다.

  - 해당 명령어는 Dockerfile내에 1회만 쓸 수 있습니다.

![image](https://user-images.githubusercontent.com/49984996/148641251-699fb379-7474-4043-b340-aff0d98780ea.png)


1. 베이스 이미지는 ubuntu를 써도 되고 centos등을 써도 되지만 hello를 출력하는 기능은 굳이 사이즈가 큰 베이스 이미지가 필요없기 때문에 alpine을 사용
2. hello 문자를 출력해주기 위해 echo를 사용해야 되는데 이미 alpine안에 echo를 사용할 수 있는 파일이 있기때문에 RUN은 생략
3. 마지막으로 컨테이너 시작시 실행될 명령어인 echo hello를 적어준다.

## 도커 파일로 도커 이미지 만들기
1. 도커 파일(저번 시간에 작성한거)에 입력된 것들이 도커 클라이언트에 전달되어서 도커 서버가 인식하게 해야 된다.
2. 그렇게 하기 위해서 docker build ./  or  docker build . 
3. build명령어는 해당 dockerfile이라는 파일을 찾아서 도커 클라이언트에 전달 해준다.
4. docker build뒤에 ./와 .는 둘다 현재 디렉토리를 가르킨다.

![image](https://user-images.githubusercontent.com/49984996/148641555-06fc0038-382d-478d-be7e-d96b8b722cf1.png)


## 결론
1. 베이스 이미지에서 다른 종속성이나 새로운 커맨드를 추가 할때는 임시 컨테이너를 만든 후 그 컨테이너를 토대로 새로운 이미지를 다시 만든다.
2. 그리고 그 임시 컨테이너는 지워 준다.

> 이미지(alpine) -> 임시 컨테이너 -> 새로운 이미지를 만듬(우리가 만든 hello-world를 출력하는 이미지)

## 내가 만든 이미지 기억하기 쉬운 이름 주기

+ docker run -it f59ee0a10d0931ccdb1a486d548904ad158af53  이런식으로 실행하다보니 이름을 붙이고 싶다.
  - 아이디 값이 아닌 이미지에 이름을 붙이고 싶다.
  - -t옵션을 사용
  - 이름 규칙

![image](https://user-images.githubusercontent.com/49984996/148641670-1ba2b057-78f3-44f9-affa-ec038c47fbdf.png)

> docker build -t gidrms99/hello:latest ./

