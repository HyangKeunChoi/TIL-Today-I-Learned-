# ElasticSearch 모니터링 하기

## cat API 활용하기
+ UI기반의 모니터링 시스템도 좋지만 cat API로 상황을 빠르게 파악하는것도 중요하다.

## cat health - 가장 기본, 가장 중요
+ ElasticSearch 클러스터의 전반적인 상태 확인

```
GET /_cat/health?v
```

+ relo : 재배치 샤드
+ init : 초기화
+ unassign : 노드에 배치되지 않은 샤드들

## 상태
+ green / yellow red

<img width="814" alt="image" src="https://user-images.githubusercontent.com/49984996/216815195-bd683d7d-6dbd-4b53-9496-9b20691024b1.png">

## cat nodes
+ 노드들의 전반적인 상태를 확인

```
GET /_cat?nodes?v
```
+ node.role : 마스터, 인제스트, 데이터 (약자로 되어 있어서 공식사이트에서 확인)
  - 별표 달려있는게 마스터
+ 기본적인 정보로 확인 가능한 정보를 제한적 입니다.
+ 뭘 볼수 있는지 확인하려면 ?

```
GET /_cat/nodes?help
```

+ 예시
```
GET /_cat/nodes?h=ip,heap.percent,disk.avail,names&v
```

## cat nodes는 언제 활용하면 좋을까요?
+ 노드들의 디스크 사용량 확인
+ 노드들이 명확한 역할을 수행하고 있는지 확인
+ 어떤 노드가 마스터 노드인지 확인
+ 노드들의 메모리 사용량 확인

## cat API 활용하기 2

#### cat indices : 인덱스의 상태를 확인할 수 있다.

```
GET /_cat/indices?v
```

+ cat health에서 봤던 상태 정보를 cat indices에서도 볼 수 있습니다.
+ 사실 클러스터의 상태는 인덱스의 상태라고 보면 됩니다.
+ 1개 이상의 인덱스가 yellow상태이면 클러스터도 yellow
+ 1개 이상의 인덱스가 red 상태이면 클러스터도 red
+ 언제 활용하면 좋을까요? 
  - 인덱스들의 프라이머리 샤드 개수와 레플리카 개수를 확인, 이상 상태인 인덱스 확인할때

#### cat shards : 샤드의 상태를 확인할 수 있다.
+ cat shards도 cat nodes와 마찬가지로 더 많은 정보를 볼 수 있습니다.
  - help를 이용

+ 언제 활용하면 좋을까요? : 이상 상태인 샤드들 확인할때
